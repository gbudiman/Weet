var weet_cloner=function(){let e,t,n,i,a,o,d,u;var r=function(){t=$("#weet-template"),n=$("#feed"),i=$("#border"),a=!1,o=!1,e=undefined,d=!1,u="Karma uninitialized",l()},l=function(){$(window).on("scroll resize",function(){window.requestAnimationFrame(function(){let e=$(window).height();i[0].getBoundingClientRect().y<e&&(a||o||c())})}),_().then(function(){c()})},_=function(){return new Promise(e=>{$.ajax({method:"GET",url:"/user/has_enough_karma"}).done(t=>{if(!0===t)d=!0,u=null;else switch(d=!1,t){case"insufficient_karma":u="Not enough karma";break;case"insufficient_pending_karma":u="Not enough karma due to pending votes"}e(!0)})})},c=function(){a=!0,$.ajax({method:"GET",url:"/weets",data:{from:e}}).done(e=>{e.length<5&&(o=!0,i.text("No more Weet to display")),e.forEach(e=>{s(e)}),a=!1})},f=function(e){$.ajax({method:"GET",url:"/weet",data:{id:e}}).done(e=>{_().then(function(){s(e,"prepend")})})},s=function(i,a){let o=a==undefined?"append":a;if(!($("[data-id="+i.id+"]").length>0)&&("prepend"==o||e==undefined||i.id<e)){let a=t.clone();a.attr("data-id",i.id),"append"==o?(n.append(a),a.show()):(n.prepend(a),a.show(400)),layout.set_content(i.id,i.weeter_id,i.weeter_name,i.weet_created_at,i.weet_content),i.weet_is_evaluated?(layout.publish_weet(i.id,i.weet_is_published),layout.enable_vote(i.id,!1)):(layout.set_vote_timer(i.id,moment(i.weet_evaluate_at)),d?layout.enable_vote(i.id,i.weeter_id!=current_user_id,"Self-voting is not permitted"):layout.enable_vote(i.id,!1,u)),"append"==o&&(e=i.id)}};return{init:r,notify_new:f}}();