var layout=function(){let t,e,a;var i=function(){o(),l(),n(),d()},n=function(){$("#navbar-user-name").editable({type:"text",url:"/edit_name",placement:"bottom",success:function(t,e){if(0==t.success){if("not_unique"==t.error)return"Username has been taken"}else $("[data-author-id="+t.pk+"]").text(e)}})},d=function(){if(0!=(t=$("#post-weet")).length){e=$("#weet-content"),a=$("#char-remaining");var i=function(e){switch(e){case"busy":t.addClass("disabled");break;case"available":t.removeClass("disabled")}},n=function(){let t=e.val().trim().length;i(0==t?"busy":"available"),a.text(280-t+" characters left")};e.on("keyup",function(){n()}),t.off("click").on("click",function(){e.attr("disabled",!0),$.ajax({method:"POST",url:"/weet",data:{content:e.val().trim()}}).done(t=>{t.success&&(e.val(""),n()),e.attr("disabled",!1)})}),n()}},o=function(){$(".not-clickable").off("click").on("click",t=>{t.preventDefault()})},l=function(){$('[data-toggle="tooltip"]');$('[data-toggle="tooltip"]').tooltip()},s=function(t){return $("[data-id="+t+"]")},r=function(t,e,a){let i=s(t),n=i.find(".slider"),d=e==undefined||e,o=i.find(".vote");if(-1==current_user_id)return;o.attr("data-id="+t),o.show();let l=i.find(".voteup"),r=i.find(".votedown");if($.ajax({method:"GET",url:"/votes",data:{id:t}}).done(t=>{l.find(".voteup-count").text(t.upvote_count).attr("data-mask","voteable"),r.find(".votedown-count").text(t.downvote_count).attr("data-mask","voteable"),t.has_voted&&(r.off("click").removeClass("enabled").attr("data-mask","has_voted"),l.off("click").removeClass("enabled").attr("data-mask","has_voted"),t.voteup?(l.addClass("persisted").attr("data-original-title","You upvoted"),r.addClass("disabled")):(l.addClass("disabled"),r.addClass("persisted").attr("data-original-title","You downvoted")))}),l.on("click",function(){i.find(".slide-text").text("Slide to Upvote"),$("#slider-"+t).show(),l.removeClass("faded"),r.addClass("faded"),n.attr("data-vote-up","true")}),r.on("click",function(){i.find(".slide-text").text("Slide to Downvote"),$("#slider-"+t).show(),r.removeClass("faded"),l.addClass("faded"),n.attr("data-vote-up","false")}),d?(o.removeClass("disabled").addClass("enabled").attr("data-mask","voteable"),i.find('[data-vote-toggle="tooltip"]').attr("data-original-title","")):(o.addClass("disabled").removeClass("enabled").off("click"),i.find('[data-vote-toggle="tooltip"]').attr("data-original-title",a==undefined?"Voting period has ended":a),a==undefined?o.attr("data-mask","voting_has_ended"):"Self-voting is not permitted"==a?o.attr("data-mask","self_vote_disabled"):o.attr("data-mask","insufficient_karma")),0==$("#slider-"+t).length){if(0==n.length)return;n.attr("id","slider-"+t),n.attr("data-id",t),SlideToUnlock.init("#slider-"+t,{height:35,margin_top:-27,font_size:14,text_slid:"Sending Vote...",text_done:"Vote Recorded!",func_slid:function(){return r.off("click").removeClass("enabled"),l.off("click").removeClass("enabled"),new Promise(t=>{$.ajax({method:"POST",url:"/vote",data:{id:n.attr("data-id"),voteup:n.attr("data-vote-up")}}).done(e=>{t(e.success)})})},func_done:function(){return new Promise(e=>{setTimeout(function(){$("#slider-"+t).hide(500)},2500),o.attr("data-mask","has_voted"),"true"==n.attr("data-vote-up")?(l.attr("data-original-title","You upvoted").addClass("persisted"),r.attr("data-original-title","You upvoted")):(r.attr("data-original-title","You downvoted").addClass("persisted"),l.attr("data-original-title","You downvoted")),e(!0)})}})}},c=function(t){let e=s(t);e.find('[data-vote-toggle="tooltip"]').tooltip(),e.find('[data-vote-remainder-toggle="tooltip"]').tooltip(),e.find('[data-blockchain-toggle="tooltip"]').tooltip()},f=function(t,e,a,i,n){let d=s(t),o=d.find(".weet-author").find("a"),l=a;e==current_user_id?(l+=" (me)",o.addClass("not-clickable").on("click",t=>{t.preventDefault()})):o.attr("href","/user/activity?id="+e),o.text(l).attr("data-author-id",e),d.find(".weet-date").text(moment(i).toDate().toLocaleString()),d.find(".weet-body").text(n),c(t),u(t,e,i,n)},u=function(t,e,a,i){let n=s(t),d=n.find(".bc-verifying");var o=function(o){o.hide(),d.show(),block_explorer.validate_checksum(t,e,moment(a).unix(),i).then(e=>{d.hide(),e?n.find(".bc-verified").show():block_explorer.get_weet(t).then(t=>{0==t[2]?n.find(".bc-not-persisted").show():n.find(".bc-corrupted").show()})})};n.find(".bc-verify").on("click",function(){o($(this))}),n.find(".bc-not-persisted").on("click",function(){o($(this))})},v=function(t,e){$("#karma-amount").text(t),m(e)},m=function(t){if(!0===t)$('[data-mask="insufficient_karma"]').each(function(){let t=$(this),e=t.parent().parent().attr("data-id");console.log(t),t.removeClass("disabled").addClass("enabled").attr("data-mask","voteable").attr("data-original-title",""),r(e,!0)});else{let e;switch(t){case"insufficient_karma":e="Insufficient karma";break;case"insufficient_pending_karma":e="Insufficient pending karma"}$('[data-mask="voteable"]').removeClass("enabled").addClass("disabled").attr("data-mask","insufficient_karma").attr("data-original-title",e).off("click")}};return{init:i,enable_vote:r,publish_weet:function(t,e){let a=s(t),i=e==undefined||e;a.find(".timer-container").hide(),i?(a.find(".weet-rejected").hide(),a.find(".weet-approved").show()):(a.find(".weet-approved").hide(),a.find(".weet-rejected").show())},set_vote_timer:function(t,e){let a=s(t),i=a.find(".timer-container"),n=a.find(".timer-bar"),d=a.find(".timer-text"),o=36e5;i.show();let l=function(e,a){let i=a-moment(),s=100*(i/o),c=parseInt(i/6e4),f=parseInt(i/1e3)%60,u=(f<10?"0":"")+f.toString();n.css("width",s+"%"),d.text(c+":"+u),i>=0?setTimeout(function(){l(e,a)},1e3):(e.parent().parent().find(".slider").hide(400),d.text("Calculating..."),r(t,!1))};setTimeout(function(){l(n,e)},1e3)},set_content:f,set_blockchain_persisted:function(t){s(t).find(".blockchain-persisted").show().tooltip()},update_vote:function(t,e,a){let i=s(t);"up"==a?i.find(".voteup-count").text(e):i.find(".votedown-count").text(e)},update_karma:v,initialize_tooltips:l,initialize_editable:n,update_author_name:function(t,e){$("[data-author-id="+t+"]").text(e)}}}();