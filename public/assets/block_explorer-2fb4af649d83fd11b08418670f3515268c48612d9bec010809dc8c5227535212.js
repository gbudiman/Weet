var block_explorer=function(){const e=10;var t,n,a,d,i,o,c,r,s=function(e){let s=e!=undefined&&e;o=$("#content"),c=$("#refresh"),i=-1,r={},$.ajax({url:"/contract_meta",method:"GET"}).done(e=>{t=e.infura_key,n=e.contract_address,a=new Web3(new Web3.providers.HttpProvider("https://ropsten.infura.io/"+t)),l(),f(),$.ajax({url:"/abi",method:"GET"}).done(e=>{d=new a.eth.Contract(e,n),s||u()})})},l=function(){c.on("click",function(){o.empty(),i=-1,r={},u()})},f=function(){$("#load-more").on("click",function(){u()})},u=function(){let e=i;-1==e?d.methods.weet_count().call().then(e=>{i=e,h(e-1)}):h(e-1)},h=async function(t){x("is_fetching");let n=Math.max(0,t-e+1),a={};if(t<0)x("end_of_content");else for(let c=t;c>=n;c--)o.append("<tr data-iteration="+c+'><td class="date">...</td><td class="time"></td><td class="weeter-id"><span class="text-id" /> <span class="text-name" /></td><td class="content"></td><td class="state"></td></tr>'),a[c]=!0,i-=1,d.methods.weets(c).call().then(n=>{o.find("[data-iteration="+c+"]").attr("data-id",n),d.methods.get_weet(parseInt(n)).call().then(d=>{let i=o.find("[data-id="+n+"]"),c=parseInt(i.attr("data-iteration")),s=moment(1e3*parseInt(d[2])).toDate(),l=d[1];i.find(".date").text(s.toLocaleDateString()),i.find(".time").text(s.toLocaleTimeString()),i.find(".weeter-id").attr("data-weeter-id",l),i.find(".weeter-id").find(".text-id").text(l),i.find(".content").text(d[3]),r[l]==undefined?r[l]=undefined:i.find(".weeter-id").find(".text-name").text(lut);let f=i.find(".state");1==d[4]?1==d[5]?(f.text("Published"),f.addClass("published")):(f.text("Rejected"),f.addClass("rejected")):f.text("Pending..."),delete a[c],0==Object.keys(a).length&&(m(),x(t-e<0?"end_of_content":"available"))})})},m=function(){let e=new Array;console.log(r),$.each(r,(t,n)=>{null==n&&e.push(t)}),$.ajax({url:"/weeter_names",method:"GET",data:{ids:e}}).done(e=>{e.forEach(e=>{e.id,e.name;o.find("[data-weeter-id="+e.id+"]").find(".text-name").text(e.name)})})},x=function(t){let n=$("#load-more");switch(t){case"is_fetching":n.prop("disabled",!0).text("Fetching...");break;case"end_of_content":n.prop("disabled",!0).text("End Of Chain");break;case"available":n.prop("disabled",!1).text("Load next "+e+" events")}};return{init:s,validate_checksum:function(e,t,n,a){return new Promise(i=>{d.methods.validate_weet(e,t,n,a).call().then(e=>{i(e)})})},get_weet:function(e){return new Promise(t=>{d.methods.get_weet(e).call().then(e=>{t(e)})})}}}();